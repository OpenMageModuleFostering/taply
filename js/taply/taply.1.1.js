!function(e,a){function t(){var e=a.createElement("div");return e.style.WebkitTransition?"webkitTransitionEnd":e.style.OTransition?"oTransitionEnd":"transitionend"}e.TaplyDlg={options:{dialogContent:'<form action="javascript:void(0)"><div class="dialog-header"><div><h4 class="modal-title taply-title">taply</h4></div></div><div class="dialog-body"><div><p>Please enter your mobile phone number to complete your payment</p><div class="input-field text-field "><input class="phone" name="phone" type="tel" value=""/></div><div class="input-field checkbox-field"><input class="save-phone" type="checkbox" id="save-mobile-number" value="save-mobile-number"/> <label for="save-mobile-number">Save mobile phone number</label></div></div></div><div class="dialog-footer"><div><button class="btn pay">Pay</button></div></div></form>',autoOpen:!1,className:"taply-dialog",closeBtn:!0,content:"",maxWidth:360,minWidth:280,overlay:!0},savedPhone:"",initialized:!1,modal:null,overlay:null,closeBtn:null,transitionEnd:t(),init:function(){if(!e.TaplyDlg.phone){var t,n=e.TaplyDlg,l=a.createDocumentFragment();n.overlay&&n.overlay.parentNode&&n.overlay.parentNode.removeChild(n.overlay),n.modal&&n.modal.parentNode&&n.modal.parentNode.removeChild(n.modal),n.options.overlay===!0&&(n.overlay=a.createElement("div"),n.overlay.className="taply-modal-overlay "+n.options.className,l.appendChild(this.overlay)),n.modal=a.createElement("div"),n.modal.className="taply-modal "+n.options.className,n.modal.style.minWidth=n.options.minWidth+"px",n.modal.style.maxWidth=n.options.maxWidth+"px",t=a.createElement("div"),t.className="taply-modal-window",t.innerHTML=n.options.dialogContent,n.content=t,n.options.closeBtn===!0?(n.closeBtn=a.createElement("button"),n.closeBtn.className="taply-modal-close pay-later",n.closeBtn.innerHTML="Close",n.modal.appendChild(t).appendChild(n.closeBtn)):this.modal.appendChild(t),l.appendChild(n.modal),a.body.appendChild(l);for(var o=n.modal.getElementsByTagName("input"),i=0;i<o.length;i++)("tel"==o[i].type||"text"==o[i].type)&&(o[i].addEventListener("keydown",e.Taply.check.bind(n.current),!1),o[i].module=n.current);n.initializeEvents(),e.TaplyDlg.initialized=!0}},send:function(){e.Taply.send(e.TaplyDlg.current)},payLater:function(){e.Taply.payLater(e.TaplyDlg.current),e.TaplyDlg.close()},cancel:function(){e.Taply.cancel(e.TaplyDlg.current),e.TaplyDlg.close()},tryagain:function(){e.TaplyDlg.open(e.TaplyDlg.current)},close:function(){var a=e.TaplyDlg;a.modal.className=a.modal.className.replace(" taply-modal-open",""),a.overlay.className=a.overlay.className.replace(" taply-modal-overlay-open","")},open:function(a){var t=e.TaplyDlg;t.current=a,t.init(),t.current.phone=t.content.getElementsByClassName("phone")[0],t.current.phone.module=a,t.current.save_phone=t.content.getElementsByClassName("save-phone")[0],void 0!==e.Taply.savedPhone&&""==t.current.phone.value&&(t.current.phone.value=e.Taply.format(e.Taply.savedPhone),t.current.save_phone.checked=1),e.getComputedStyle(t.modal).height,t.modal.className=t.modal.className+" taply-modal-open",t.overlay.className=t.overlay.className+" taply-modal-overlay-open",setTimeout(function(){t.current.phone.focus()},300)},initializeEvents:function(){var t=e.TaplyDlg,n=a.getElementsByClassName("close-modal");if(n)for(var l=0;l<n.length;l++)n[l].addEventListener("click",t.cancel.bind(t),!1);this.overlay&&this.overlay.addEventListener("click",t.close.bind(t));var o=t.content.getElementsByClassName("btn pay");o.length&&o[0].addEventListener("click",t.send.bind(t),!1);var i=t.modal.getElementsByClassName("pay-later");i.length&&i[0].addEventListener("click",t.payLater.bind(t),!1);var s=t.content.getElementsByClassName("btn try-again");s.length&&s[0].addEventListener("click",t.tryagain.bind(t),!1)},changeContent:function(a){var t=e.TaplyDlg.content.getElementsByClassName("dialog-body")[0],n="Unknown error",l="";switch(a){case 0:n="<div><p>"+(e.Taply.notifyMessages[a]?e.Taply.notifyMessages[a]:n)+"</p></div>",l='<div><button class="btn try-again">Try again</button></div>';break;case 1:n='<div><div class="loader">Loading</div><p>'+e.Taply.notifyMessages[a]+"</p></div>",l="<div>"+(e.Taply.showPayLater?'<button class="btn pay-later">Pay later</button>':"")+'<button class="btn btn-alt close-modal">Cancel</button></div>';break;default:n="<div><p>"+(e.Taply.notifyMessages[a]?e.Taply.notifyMessages[a]:n)+"</p></div>"}e.TaplyDlg.content.getElementsByClassName("dialog-footer")[0].innerHTML=l,t.innerHTML=n,e.TaplyDlg.initializeEvents()}},e.TaplyModule=function(t,n){var l=this;switch(l.id=n,l.el=t,l.type=t.attributes["data-type"]?t.attributes["data-type"].value:"item",l.phone=null,l.save_phone=null,l.view_type=t.attributes["data-view-type"]?t.attributes["data-view-type"].value:"popup",l.view_type){case"block":var o=t.getElementsByTagName("input");if(o.length)for(var i=0;i<o.length;i++)"phone"==o[i].name&&(l.phone=null===l.phone?o[i]:l.phone,o[i].addEventListener("keydown",e.Taply.check.bind(l),!1),o[i].module=l),"save-phone"==o[i].name&&(l.save_phone=o[i]);break;case"popup":void 0===e.Taply.dlg_css&&(e.Taply.dlg_css=document.createElement("link"),e.Taply.dlg_css.setAttribute("rel","stylesheet"),e.Taply.dlg_css.setAttribute("type","text/css"),e.Taply.dlg_css.setAttribute("href","//www.paybytaply.com/css/taply-dialog.css"),a.getElementsByTagName("head")[0].appendChild(e.Taply.dlg_css))}l.btn=t.getElementsByClassName("taply-btn"),l.btn.length&&(l.btn[0].onclick=function(a){switch(l.view_type){case"block":e.Taply.send(l);break;case"popup":e.TaplyDlg.open(l)}return!1}),l.notify=function(a){var t=e.Taply.notifyMessages[a];switch(l.view_type){case"block":var n=l.el.getElementsByClassName("note");n.length&&(n[0].innerHTML="<p>"+t+"</p>");break;case"popup":e.TaplyDlg.changeContent(a)}}},e.Taply={apiurl:"https://api.paybytaply.com/payment",btnClass:"taply-block",modules:[],mask:"(___) ___-____",notifies:{invalidPhone:0,complete:1,firstTime:2,notInstall:3,serverError:4,notActivate:5},notifyMessages:{"-3":"Your transaction has been refunded.","-2":"Your transaction has been deleted.","-1":"Your transaction has been canceled.",0:"Please enter a valid phone number.",1:"Please complete your payment on your taply mobile app.",2:"Good news! Save $10 off your first taply transaction. Please download the taply app using the link texted to your mobile phone.",3:"Please download the taply app using the link texted to your mobile phone.",4:"Unknown error.",5:"Please activate the taply app.",10:"Your transaction has been pending.",11:"Your transaction has been approved.",12:"Your order has been sent to your taply mobile app for checkout at a later time."},ls:function(e,t){var n=a.getElementsByTagName("head")[0]||a.documentElement,l=a.createElement("script");l.src=e,l.onload=l.onreadystatechange=function(){n.removeChild(l)},n.insertBefore(l,n.firstChild)},format:function(a){var t="",n=0,l=e.Taply.mask;if(a=a.replace(/[^\d]/g,""),a.length)for(var o=0;o<l.length;o++)if("_"!=l[o])t+=l[o];else{if(!a[n])break;t+=a[n++]}return t},check:function(a){var t=a.keyCode||a.charCode;a.ctrlKey||t>47&&58>t||8==t||9==t||a.preventDefault();var n=this.phone.value,l=parseInt(n.replace(/[^\d]/g,""),10);switch(l=isNaN(l)?"":l.toString(),a.keyCode){case 9:return;case 13:e.Taply.send(this);case 8:return!0;case 46:l=l.substr(0,l.length-1);break;default:var o=String.fromCharCode(a.keyCode);if(a.keyCode>47&&a.keyCode<58)l+=o;else{if(!(a.keyCode>95&&a.keyCode<106))return!1;l+=a.keyCode-96}}return this.phone.value=e.Taply.format(l),a.preventDefault(),!1},init:function(){e.Taply.initValues();for(var t=a.getElementsByClassName(e.Taply.btnClass),n=0;n<t.length;n++)e.Taply.modules.push(new e.TaplyModule(t[n],e.Taply.modules.length))},initValues:function(){var t=e.localStorage.getItem("taply_phone");if(t){e.Taply.savedPhone=t;for(var n=a.getElementsByClassName(e.Taply.btnClass),l=0;l<n.length;l++)for(var o=n[l].getElementsByTagName("input"),i=0;i<o.length;i++)"phone"==o[i].name&&(o[i].value=t),"save-phone"==o[i].name&&(o[i].checked=1)}},getCookie:function(e){var a=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return a?decodeURIComponent(a[1]):void 0},getParamStr:function(a,t){var n="";switch(a.type){case"item":n="&iuid="+a.el.attributes["data-iuid"].value;break;case"cart":if(a.el.attributes["data-shop"]&&"shopify"===a.el.attributes["data-shop"].value){var l=JSON.parse(a.el.attributes["data-cart"].value);l.shopify_cart=e.Taply.getCookie("cart"),a.el.attributes["data-cart"].value=JSON.stringify(l)}n="&cart="+encodeURIComponent(a.el.attributes["data-cart"].value);break;case"auto":}return n+="&phone="+a.phone.value.replace(/[\W_]/g,"")+"&save_phone="+(a.save_phone.checked?1:0)+"&block_id="+a.id},verify:function(a){var t=new RegExp(/\(?([0-9]{3})\)?[\s]{0,1}[0-9]{3}[-]?[0-9]{4}/);return t.test(a.phone.value)?!0:(a.notify(e.Taply.notifies.invalidPhone),!1)},send:function(a){clearInterval(e.Taply.ch),a.save_phone.checked&&(e.Taply.savedPhone=a.phone.value,e.localStorage.setItem("taply_phone",e.Taply.savedPhone)),e.Taply.verify(a)&&e.Taply.ls(e.Taply.apiurl+"/add?callback=Taply.checkResponse"+e.Taply.getParamStr(a))},cancel:function(a){clearInterval(e.Taply.ch),a.pid&&(e.Taply.ls(e.Taply.apiurl+"/cancel?callback=n&payment="+a.pid),a.initialized=!1)},payLater:function(a){clearInterval(e.Taply.ch),a.pid&&(e.Taply.ls(e.Taply.apiurl+(e.Taply.showPayLater?"/paylater":"/cancel")+"?callback=n&payment="+a.pid),a.initialized=!1)},checkResponse:function(a){var t,n="";if(void 0!==a.result&&(t=e.Taply.modules[a.result.block_id]),"success"==a.status){if(void 0===t)return;e.Taply.showPayLater=a.result.pay_later_button,a.result.payment_result?(n=e.Taply.notifies.complete,e.Taply.ch=setInterval(e.Taply.checkPayment,1e3,a.result.payment)):(n=e.Taply.notifies.notActivate,a.result.firsttime&&(n=e.Taply.notifies.firstTime),a.result.sms_status&&(n=e.Taply.notifies.notInstall))}else{n=e.Taply.notifies.serverError,e.Taply.notifyMessages[n]="";for(var l=0;l<a.errors.length;l++){if("E00901"===a.errors[l].error_code){n=e.Taply.notifies.invalidPhone;break}e.Taply.notifyMessages[n]+=a.errors[l].error_message}}void 0!==t?(t.pid=a.result.payment,t.notify(n)):e.TaplyDlg.changeContent(n),(n==e.Taply.notifies.notInstall||n==e.Taply.notifies.notActivate)&&e.setTimeout(function(){t.notify(1),e.Taply.ch=setInterval(e.Taply.checkPayment,1e3,a.result.payment)},5e3)},checkPayment:function(a){e.Taply.ls(e.Taply.apiurl+"/get-payment-status?callback=Taply.checkPaymentResponse&payment="+a)},checkPaymentResponse:function(a){var t="Unknown Error, try later";if("success"==a.status){if(0==a.result.payment_status)return;e.TaplyDlg.current&&(e.TaplyDlg.current.pid=null),clearInterval(e.Taply.ch),t=a.result.payment_status<0?a.result.payment_status:a.result.payment_status+10,void 0!==a.result.redirect&&setTimeout(function(){e.location=a.result.redirect},3e3)}e.TaplyDlg.current&&e.TaplyDlg.current.notify(t)}};var n=document.createElement("style");n.innerHTML=".pay-module .taply-apply-pay {background: url( //www.paybytaply.com/static/img/asset/pay-by-taply-btn-dark-wide.png ) no-repeat;display: block;float: right;height: 53px;margin-bottom: 10px;font-size: 0;width: 248px;}@media only screen and (min--moz-device-pixel-ratio: 2),only screen and (-o-min-device-pixel-ratio: 2/1),only screen and (-webkit-min-device-pixel-ratio: 2),only screen and (min-device-pixel-ratio: 2) {.pay-module .taply-apply-pay {background-image: url( //www.paybytaply.com/static/img/asset/pay-by-taply-btn-dark-wide-2x.png ); background-size: 248px 53px;}}.pay-module a {color: #6a0fa5; text-decoration: none; }.pay-module a:hover {text-decoration: underline; }.pay-module p {color: #959595; font-size: 16px; clear: both;}.pay-module h4 {color: #595959; font-size: 16px; margin-bottom: 10px; }.taply-modal button {   box-shadow: none;   }",a.getElementsByTagName("head")[0].appendChild(n),"complete"===document.readyState?e.Taply.init():e.addEventListener("load",e.Taply.init.bind(e),!1)}(window,document);